---
title: Git Hooks
description: 了解如何使用和配置 igit 的 Git Hooks
---

import { Aside } from '@astrojs/starlight/components';

## 什么是 Git Hooks? 🎣

Git Hooks 是在 Git 仓库中特定事件发生时自动执行的脚本。igit 提供了一套预配置的 Git Hooks，帮助你规范化代码提交流程，确保代码质量。


### pre-push

在推送到远程仓库前执行，用于运行测试等任务。

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - npm run test
      - npm run build
```

## 配置说明 ⚙️

### Git Hooks 配置

```yaml
hooks:
  # 是否启用 hooks
  enabled: true
  # hooks 配置
  hooks:
    # 可以配置任意 Git hook
    pre-commit:
      - command1
      - command2
    commit-msg:
      - command1
    pre-push:
      - command1
```

### 暂存区 Hooks 配置

```yaml
staged_hooks:
  # 是否启用暂存区 hooks
  enabled: true
  # 针对不同文件类型的规则
  rules:
    "**/*.{js,ts}":
      - eslint --fix
    "**/*.{css,scss}":
      - stylelint --fix
```

### 命令执行

- 命令按照配置文件中的顺序依次执行
- 如果任何命令执行失败（返回非零状态码），hook 将终止执行
- 支持所有 shell 命令和 npm 脚本

## 最佳实践 💡

### 1. 代码检查

使用暂存区 hooks 配置代码检查：

```yaml
staged_hooks:
  enabled: true
  rules:
    "*.{js,ts,vue}":
      - eslint --fix
      - prettier --write
    "*.{css,scss,less}":
      - stylelint --fix
```

### 2. 提交信息规范

使用 `commit-msg` 确保提交信息符合团队规范：

```yaml
hooks:
  commit-msg:
    enable: true
    pattern: "^(PROJ-\\d+|merge): .{1,50}"
```

### 3. 测试保障

使用 pre-push hook 运行测试：

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - npm run test:coverage
      - npm run build
```

## 常见问题 ❓

### Q: 如何跳过 hook 检查？

在特殊情况下，你可以使用 Git 的 `--no-verify` 选项跳过 hook 检查：

```bash
git commit --no-verify -m "your message"
git push --no-verify
```

<Aside type="caution">
  请谨慎使用 `--no-verify`，它会跳过所有的 hook 检查。
</Aside>

### Q: hook 执行失败怎么办？

1. 检查错误信息，修复相关问题
2. 确保所有命令都能在命令行中正常执行
3. 检查配置文件中的命令是否正确

## 高级用法 🚀

### 自定义 Hook 脚本

除了直接运行命令，你还可以编写自定义的 hook 脚本：

```yaml
hooks:
  enabled: true
  hooks:
    pre-commit:
      - node scripts/custom-hook.js
```

### 条件执行

你可以根据不同的条件执行不同的命令：

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - '[[ "$BRANCH" == "main" ]] && npm run test:e2e || echo "Skipping e2e tests"'
```

### 环境变量

hook 中可以访问所有的环境变量，包括 Git 相关的变量：

```yaml
hooks:
  enabled: true
  hooks:
    pre-commit:
      - echo "Current branch: $GIT_BRANCH"
```
