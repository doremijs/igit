---
title: Git Hooks
description: äº†è§£å¦‚ä½•ä½¿ç”¨å’Œé…ç½® igit çš„ Git Hooks
---

import { Aside } from '@astrojs/starlight/components';

## ä»€ä¹ˆæ˜¯ Git Hooks? ğŸ£

Git Hooks æ˜¯åœ¨ Git ä»“åº“ä¸­ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬ã€‚igit æä¾›äº†ä¸€å¥—é¢„é…ç½®çš„ Git Hooksï¼Œå¸®åŠ©ä½ è§„èŒƒåŒ–ä»£ç æäº¤æµç¨‹ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚


### pre-push

åœ¨æ¨é€åˆ°è¿œç¨‹ä»“åº“å‰æ‰§è¡Œï¼Œç”¨äºè¿è¡Œæµ‹è¯•ç­‰ä»»åŠ¡ã€‚

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - npm run test
      - npm run build
```

## é…ç½®è¯´æ˜ âš™ï¸

### Git Hooks é…ç½®

```yaml
hooks:
  # æ˜¯å¦å¯ç”¨ hooks
  enabled: true
  # hooks é…ç½®
  hooks:
    # å¯ä»¥é…ç½®ä»»æ„ Git hook
    pre-commit:
      - command1
      - command2
    commit-msg:
      - command1
    pre-push:
      - command1
```

### æš‚å­˜åŒº Hooks é…ç½®

```yaml
staged_hooks:
  # æ˜¯å¦å¯ç”¨æš‚å­˜åŒº hooks
  enabled: true
  # é’ˆå¯¹ä¸åŒæ–‡ä»¶ç±»å‹çš„è§„åˆ™
  rules:
    "**/*.{js,ts}":
      - eslint --fix
    "**/*.{css,scss}":
      - stylelint --fix
```

### å‘½ä»¤æ‰§è¡Œ

- å‘½ä»¤æŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ
- å¦‚æœä»»ä½•å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼ˆè¿”å›éé›¶çŠ¶æ€ç ï¼‰ï¼Œhook å°†ç»ˆæ­¢æ‰§è¡Œ
- æ”¯æŒæ‰€æœ‰ shell å‘½ä»¤å’Œ npm è„šæœ¬

## æœ€ä½³å®è·µ ğŸ’¡

### 1. ä»£ç æ£€æŸ¥

ä½¿ç”¨æš‚å­˜åŒº hooks é…ç½®ä»£ç æ£€æŸ¥ï¼š

```yaml
staged_hooks:
  enabled: true
  rules:
    "*.{js,ts,vue}":
      - eslint --fix
      - prettier --write
    "*.{css,scss,less}":
      - stylelint --fix
```

### 2. æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨ `commit-msg` ç¡®ä¿æäº¤ä¿¡æ¯ç¬¦åˆå›¢é˜Ÿè§„èŒƒï¼š

```yaml
hooks:
  commit-msg:
    enable: true
    pattern: "^(PROJ-\\d+|merge): .{1,50}"
```

### 3. æµ‹è¯•ä¿éšœ

ä½¿ç”¨ pre-push hook è¿è¡Œæµ‹è¯•ï¼š

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - npm run test:coverage
      - npm run build
```

## å¸¸è§é—®é¢˜ â“

### Q: å¦‚ä½•è·³è¿‡ hook æ£€æŸ¥ï¼Ÿ

åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Git çš„ `--no-verify` é€‰é¡¹è·³è¿‡ hook æ£€æŸ¥ï¼š

```bash
git commit --no-verify -m "your message"
git push --no-verify
```

<Aside type="caution">
  è¯·è°¨æ…ä½¿ç”¨ `--no-verify`ï¼Œå®ƒä¼šè·³è¿‡æ‰€æœ‰çš„ hook æ£€æŸ¥ã€‚
</Aside>

### Q: hook æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥é”™è¯¯ä¿¡æ¯ï¼Œä¿®å¤ç›¸å…³é—®é¢˜
2. ç¡®ä¿æ‰€æœ‰å‘½ä»¤éƒ½èƒ½åœ¨å‘½ä»¤è¡Œä¸­æ­£å¸¸æ‰§è¡Œ
3. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤æ˜¯å¦æ­£ç¡®

## é«˜çº§ç”¨æ³• ğŸš€

### è‡ªå®šä¹‰ Hook è„šæœ¬

é™¤äº†ç›´æ¥è¿è¡Œå‘½ä»¤ï¼Œä½ è¿˜å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„ hook è„šæœ¬ï¼š

```yaml
hooks:
  enabled: true
  hooks:
    pre-commit:
      - node scripts/custom-hook.js
```

### æ¡ä»¶æ‰§è¡Œ

ä½ å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„å‘½ä»¤ï¼š

```yaml
hooks:
  enabled: true
  hooks:
    pre-push:
      - '[[ "$BRANCH" == "main" ]] && npm run test:e2e || echo "Skipping e2e tests"'
```

### ç¯å¢ƒå˜é‡

hook ä¸­å¯ä»¥è®¿é—®æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬ Git ç›¸å…³çš„å˜é‡ï¼š

```yaml
hooks:
  enabled: true
  hooks:
    pre-commit:
      - echo "Current branch: $GIT_BRANCH"
```
